name: Add n8n Workflows (Create PR)
on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write
  
jobs:
  add-workflows:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: true

      - name: Configure git
        run: |
          git config user.name "sainathai-bot"
          git config user.email "noreply@sainathai.local"

      - name: Create workflow directory
        run: mkdir -p n8n/workflows

      - name: Write rotation-scheduler.json
        run: |
          echo '{' > n8n/workflows/rotation-scheduler.json
          echo '  "name": "rotation-scheduler",' >> n8n/workflows/rotation-scheduler.json
          echo '  "nodes": []' >> n8n/workflows/rotation-scheduler.json
          echo '}' >> n8n/workflows/rotation-scheduler.json

      - name: Write content-generator.json
        run: |
          echo '{' > n8n/workflows/content-generator.json
          echo '  "name": "content-generator",' >> n8n/workflows/content-generator.json
          echo '  "nodes": []' >> n8n/workflows/content-generator.json
          echo '}' >> n8n/workflows/content-generator.json

      - name: Write canva-builder.json
        run: |
          echo '{' > n8n/workflows/canva-builder.json
          echo '  "name": "canva-builder",' >> n8n/workflows/canva-builder.json
          echo '  "nodes": []' >> n8n/workflows/canva-builder.json
          echo '}' >> n8n/workflows/canva-builder.json

      - name: Write export-monitor.json
        run: |
          echo '{' > n8n/workflows/export-monitor.json
          echo '  "name": "export-monitor",' >> n8n/workflows/export-monitor.json
          echo '  "nodes": []' >> n8n/workflows/export-monitor.json
          echo '}' >> n8n/workflows/export-monitor.json

      - name: Write pinterest-poster.json
        run: |
          echo '{' > n8n/workflows/pinterest-poster.json
          echo '  "name": "pinterest-poster",' >> n8n/workflows/pinterest-poster.json
          echo '  "nodes": []' >> n8n/workflows/pinterest-poster.json
          echo '}' >> n8n/workflows/pinterest-poster.json

      - name: Write analytics-engine.json
        run: |
          echo '{' > n8n/workflows/analytics-engine.json
          echo '  "name": "analytics-engine",' >> n8n/workflows/analytics-engine.json
          echo '  "nodes": []' >> n8n/workflows/analytics-engine.json
          echo '}' >> n8n/workflows/analytics-engine.json

      - name: Create Pull Request (auto)
        uses: peter-evans/create-pull-request@v5
        with:
          token: ${{ secrets.GITHUB_TOKEN }}
          commit-message: "chore: add n8n workflow JSON files"
          branch: add-n8n-workflows-${{ github.run_id }}
          title: "Add n8n workflow JSON placeholders"
          body: "This PR adds placeholder JSON files for n8n workflows."
          base: main
