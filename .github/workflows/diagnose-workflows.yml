
name: Diagnose Workflows
on:
  workflow_dispatch:

permissions:
  contents: write
  pull-requests: write


jobs:
  diagnose:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout main
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Show Git branches
        run: |
          echo "=== BRANCHES ==="
          git branch -a
          echo

      - name: Show .github/workflows files (repo root)
        run: |
          echo "=== LIST: .github/workflows ==="
          ls -la .github/workflows || true
          echo
          echo "=== SHOW FILES (raw) ==="
          for f in .github/workflows/*; do
            echo "---- $f ----"
            sed -n '1,200p' "$f" || true
            echo
          done

      - name: Show recent commits touching workflows
        run: |
          echo "=== RECENT COMMITS that touched workflows (last 50) ==="
          git log --pretty=format:'%h %ad %an %s' --date=short -n 50 -- .github/workflows || true

      - name: Print run env (for debugging)
        run: |
          echo "GITHUB_REF=$GITHUB_REF"
          echo "GITHUB_SHA=$GITHUB_SHA"
          echo "GITHUB_WORKFLOW=$GITHUB_WORKFLOW"
